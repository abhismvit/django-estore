{% extends "base.html" %}

{% block content %}
    <div class="row">
        <div class="col-sm-8">
            <h2>{{ object.title }}</h2>
        <div>
            {% if object.productimage_set.count > 0 %}
                {% for img in object.productimage_set.all %}
                    <img class="img-responsive" src="{{ img.image.url }}">
                {% endfor %}
            {% endif %}
        </div>
            <p class="lead">
                {{ object.description }}
            </p>
        </div>
        <!--Product Sidebar-->
        <div class="col-sm-4">
            {% if object.variation_set.count > 1 %}
                <h3 id="price">{{ object.price }}</h3>
                <select class="form-control variation_select">
                    {% for variation in object.variation_set.all %}
                        <option data-sale-price="{{ variation.sale_price }}" data-price="{{ variation.price }}" value="{{ variation.id }}">
                            {{ variation }}
                        </option>
                    {% endfor %}
                </select>
            {% else %}
                <h3 id="price">
                {% if object.variation_set.first.sale_price %}
                    {{ object.variation_set.first.sale_price }}
                    <small class="og-price">{{ object.variation_set.first.price }}</small>
                {% else %}
                    {{ object.variation_set.first.price }}
                {% endif %}
                </h3>
            {% endif %}
            <br>
            <a href="#">Add to Cart</a>
            <br><hr>
            <p>
                Share<br>
                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}">
                    <i class="fa fa-facebook-square fa-3x" aria-hidden="true"></i>
                </a>
            </p>
            <h4>Related Products</h4>
        </div>
        <!--End Product Sidebar-->
    </div>
{% endblock %}

{% block pageJs %}
    {% load static %}
    <script src="{% static 'js/product_detail.js' %}"></script>
    <script>

    function setPrice() {
        var price = $('.variation_select option:selected').attr("data-price");
        var sale_price = $('.variation_select option:selected').attr("data-sale-price");
        if (sale_price  != "None" || sale_price==null) {
            $("#price").html(sale_price + " " + "<small class='og-price'>" + price + "</small>");
        }
        else {
            $('#price').text(price);
        }
    }

    $(document).ready(function () {
        //setPrice();
        $(".variation_select").change(function () {
            setPrice();
        })
    });
    </script>
{% endblock %}
